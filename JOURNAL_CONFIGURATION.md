# üìã JOURNAL DE CONFIGURATION - Sprint MiniRSN

**Date de d√©but** : 13 octobre 2025
**Projet** : Sprint-MiniRSN (Application Symfony avec Docker)

---

## üéØ OBJECTIF GLOBAL

Mettre en place un environnement Docker complet pour l'application Symfony avec :
- PHP 8.3 + Apache
- MySQL 8.0
- phpMyAdmin
- MailHog (interception emails)

---

## ‚úÖ √âTAPE 1 : CR√âATION DE LA STRUCTURE DOCKER

### Actions r√©alis√©es :
```bash
mkdir -p docker/php
```

### Fichiers cr√©√©s :
- `docker/php/` (dossier)

### Impact sur le projet :
- Cr√©ation d'un dossier d√©di√© pour la configuration Docker
- S√©paration claire entre le code applicatif et la configuration infrastructure
- Suit les bonnes pratiques de l'architecture Docker

### √âtat du projet :
```
Sprint-MiniRSN/
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îî‚îÄ‚îÄ php/          ‚Üê NOUVEAU
‚îú‚îÄ‚îÄ src/
‚îú‚îÄ‚îÄ public/
‚îî‚îÄ‚îÄ ...
```

---

## ‚úÖ √âTAPE 2 : CR√âATION DU DOCKERFILE PHP

### Actions r√©alis√©es :
Cr√©ation du fichier `docker/php/Dockerfile`

### Contenu du Dockerfile :
```dockerfile
FROM php:8.3-apache
RUN docker-php-ext-install pdo pdo_mysql
COPY --from=composer:latest /usr/bin/composer /usr/bin/composer
RUN a2enmod rewrite
COPY apache.conf /etc/apache2/sites-available/000-default.conf
WORKDIR /var/www/html
RUN chown -R www-data:www-data /var/www/html
```

### Impact sur le projet :
- **Image de base** : PHP 8.3 avec Apache int√©gr√©
- **Extensions PHP** : Installation de `pdo` et `pdo_mysql` pour la connexion √† MySQL
- **Composer** : Copi√© depuis l'image officielle Composer (permet d'installer les d√©pendances Symfony)
- **Module Apache** : `rewrite` activ√© (n√©cessaire pour le routing Symfony avec URLs propres)
- **Configuration Apache** : Copie de notre fichier de configuration personnalis√©
- **Permissions** : Les fichiers appartiennent √† l'utilisateur `www-data` (utilisateur Apache standard)

### Pourquoi ces choix ?
- `pdo_mysql` : Sans cette extension, Symfony ne peut PAS se connecter √† MySQL
- `rewrite` : Sans ce module, seules les URLs basiques fonctionnent (pas de `/user/profile`, etc.)
- Composer : N√©cessaire pour installer les bundles Symfony

---

## ‚úÖ √âTAPE 3 : CR√âATION DE LA CONFIGURATION APACHE

### Actions r√©alis√©es :
Cr√©ation du fichier `docker/php/apache.conf`

### Contenu du fichier :
```apache
<VirtualHost *:80>
    ServerName localhost
    DocumentRoot /var/www/html/public

    <Directory /var/www/html/public>
        AllowOverride All
        Require all granted
        Options -Indexes +FollowSymLinks
        FallbackResource /index.php
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
```

### Impact sur le projet :
- **DocumentRoot** : Pointe vers `/var/www/html/public` (dossier public de Symfony)
  - Sans √ßa : Apache chercherait les fichiers √† la racine et l'app ne d√©marrerait pas

- **AllowOverride All** : Permet √† Symfony d'utiliser son `.htaccess`
  - Impact : Active le syst√®me de routing Symfony

- **Require all granted** : Autorise l'acc√®s public
  - Sans √ßa : Erreur 403 Forbidden

- **FallbackResource /index.php** : Toutes les requ√™tes passent par `index.php`
  - Impact : C'est le c≈ìur du front controller Symfony
  - Exemple : `/user/profile` ‚Üí `/index.php` ‚Üí Routing Symfony ‚Üí Controller

### Pourquoi c'est crucial ?
Sans cette configuration, l'application Symfony afficherait des erreurs 404 sur toutes les routes sauf la page d'accueil.

---

## ‚úÖ √âTAPE 4 : CR√âATION DU DOCKER-COMPOSE.YML

### Actions r√©alis√©es :
Cr√©ation du fichier `docker-compose.yml` avec 4 services

### Contenu :
```yaml
version: '3.8'

services:
  php:          # Service PHP + Apache
  db:           # Service MySQL
  phpmyadmin:   # Interface graphique MySQL
  mailhog:      # Interception emails

networks:
  symfony_network:
    driver: bridge

volumes:
  db_data:      # Persistance des donn√©es MySQL
```

### Impact d√©taill√© par service :

#### 1. Service PHP + Apache (`php`)
```yaml
build: ./docker/php
ports: "8000:80"
volumes: ./:/var/www/html
networks: symfony_network
depends_on: db
```

**Impact** :
- Construction de l'image depuis notre Dockerfile personnalis√©
- Port 8000 de votre machine ‚Üí Port 80 du container
- **Volume bind mount** : Synchronisation en temps r√©el du code
  - Modification locale ‚Üí Visible instantan√©ment dans le container
- D√©pend de `db` : D√©marre apr√®s MySQL

#### 2. Service MySQL (`db`)
```yaml
image: mysql:8.0
ports: "3306:3306"
environment:
  MYSQL_ROOT_PASSWORD: root
  MYSQL_DATABASE: symfony_db
volumes: db_data:/var/lib/mysql
```

**Impact** :
- Image officielle MySQL 8.0
- Base de donn√©es `symfony_db` cr√©√©e automatiquement
- **Named volume** : Les donn√©es persistent m√™me si le container est supprim√©
- Accessible via le hostname `db` (PAS `localhost`)

#### 3. Service phpMyAdmin (`phpmyadmin`)
```yaml
image: phpmyadmin/phpmyadmin
ports: "8080:80"
environment:
  PMA_HOST: db
```

**Impact** :
- Interface web pour g√©rer MySQL
- Se connecte automatiquement au service `db`
- Login : `root` / `root`

#### 4. Service MailHog (`mailhog`)
```yaml
image: mailhog/mailhog
ports:
  - "1025:1025"  # SMTP
  - "8025:8025"  # Web UI
```

**Impact** :
- Intercepte tous les emails envoy√©s par Symfony
- Les emails ne sont PAS vraiment envoy√©s
- Interface web pour les consulter

### R√©seau Docker :
```yaml
networks:
  symfony_network:
    driver: bridge
```

**Impact** :
- Tous les services peuvent communiquer entre eux
- Utilisation du nom du service comme hostname DNS
- Exemple : `php` peut joindre `db` via le hostname `db`

---

## ‚úÖ √âTAPE 5 : MISE √Ä JOUR DU FICHIER .ENV

### Actions r√©alis√©es :
Modification du fichier `.env` de Symfony

### Changements effectu√©s :

#### Avant :
```env
DATABASE_URL="postgresql://app:!ChangeMe!@127.0.0.1:5432/app?serverVersion=16&charset=utf8"
MAILER_DSN=null://null
```

#### Apr√®s :
```env
DATABASE_URL="mysql://root:root@db:3306/symfony_db?serverVersion=8.0&charset=utf8mb4"
MAILER_DSN=smtp://mailhog:1025
```

### Impact sur le projet :

#### 1. DATABASE_URL
- **Changement de SGBD** : PostgreSQL ‚Üí MySQL
- **Hostname** : `127.0.0.1` ‚Üí `db`
  - `127.0.0.1` (localhost) ne fonctionne PAS dans Docker
  - `db` est le nom du service MySQL dans docker-compose.yml
- **Credentials** : `root:root` (d√©finis dans docker-compose.yml)
- **Base de donn√©es** : `symfony_db` (cr√©√©e automatiquement au d√©marrage)

**Pourquoi `@db` et pas `@localhost` ?**
- Chaque container Docker a son propre `localhost`
- Pour communiquer entre containers, on utilise le nom du service
- Docker fournit un DNS interne qui r√©sout `db` vers l'IP du container MySQL

#### 2. MAILER_DSN
- **Avant** : `null://null` (aucun email envoy√©)
- **Apr√®s** : `smtp://mailhog:1025` (interception par MailHog)

**Impact** :
- Les emails sont intercept√©s par MailHog
- Consultables via http://localhost:8025
- √âvite l'envoi de vrais emails pendant le d√©veloppement

---

## ‚úÖ √âTAPE 6 : SUPPRESSION DES ANCIENS FICHIERS

### Actions r√©alis√©es :
```bash
docker-compose down
rm compose.yaml compose.override.yaml
```

### Fichiers supprim√©s :
- `compose.yaml` (configuration PostgreSQL auto-g√©n√©r√©e par Symfony)
- `compose.override.yaml` (surcharges pour le d√©veloppement)

### Impact sur le projet :
- **√âvite les conflits** : Docker utilisait `compose.yaml` en priorit√©
- **Configuration unique** : Un seul fichier `docker-compose.yml` √† maintenir
- **Coh√©rence** : Suppression de la config PostgreSQL (remplac√©e par MySQL)

---

## ‚úÖ √âTAPE 7 : D√âMARRAGE DES SERVICES DOCKER

### Actions r√©alis√©es :
```bash
docker-compose up -d --build
```

### D√©tail de la commande :
- `up` : D√©marre les services
- `-d` : Mode d√©tach√© (en arri√®re-plan)
- `--build` : Reconstruit les images si modifi√©es

### Impact sur le projet :

#### 1. Construction de l'image PHP
- T√©l√©chargement de l'image PHP 8.3-Apache
- Installation des extensions `pdo` et `pdo_mysql`
- Installation de Composer
- Configuration d'Apache avec notre fichier `apache.conf`

#### 2. D√©marrage des containers
- **symfony_php** : Application Symfony accessible sur port 8000
- **symfony_db** : MySQL 8.0 accessible sur port 3306
- **symfony_phpmyadmin** : phpMyAdmin accessible sur port 8080
- **symfony_mailhog** : MailHog accessible sur ports 1025 et 8025

#### 3. Cr√©ation du r√©seau
- **symfony_network** : R√©seau bridge pour la communication inter-containers

#### 4. Cr√©ation du volume
- **db_data** : Volume persistant pour les donn√©es MySQL

---

## ‚ùå √âTAPE 8 : R√âSOLUTION DU PROBL√àME "vendor/autoload_runtime.php not found"

### Probl√®me rencontr√© :
Lors de l'acc√®s √† http://localhost:8000, l'erreur suivante est apparue :
```
Warning: require_once(/var/www/html/vendor/autoload_runtime.php): Failed to open stream: No such file or directory in /var/www/html/public/index.php on line 5

Fatal error: Uncaught Error: Failed opening required '/var/www/html/vendor/autoload_runtime.php'
```

### Cause du probl√®me :
Le dossier `vendor/` (contenant les d√©pendances Composer) n'existait pas dans le container car :
1. **Les d√©pendances n'√©taient pas install√©es**
2. **Git et unzip manquaient dans le Dockerfile**, emp√™chant Composer de t√©l√©charger les packages

### Solution appliqu√©e :

#### 1. Modification du Dockerfile
Ajout des outils syst√®me n√©cessaires √† Composer :

**Avant** :
```dockerfile
FROM php:8.3-apache

# Installer les extensions PHP n√©cessaires
RUN docker-php-ext-install pdo pdo_mysql
```

**Apr√®s** :
```dockerfile
FROM php:8.3-apache

# Installer les d√©pendances syst√®me n√©cessaires
RUN apt-get update && apt-get install -y \
    git \
    unzip \
    zip \
    && rm -rf /var/lib/apt/lists/*

# Installer les extensions PHP n√©cessaires
RUN docker-php-ext-install pdo pdo_mysql
```

**Impact** :
- `git` : Permet √† Composer de cloner les d√©pendances depuis les d√©p√¥ts Git
- `unzip` : Permet √† Composer de d√©compresser les archives t√©l√©charg√©es
- `zip` : Utile pour certaines op√©rations Composer
- `&& rm -rf /var/lib/apt/lists/*` : Nettoie le cache APT pour r√©duire la taille de l'image

#### 2. Reconstruction de l'image Docker
```bash
docker-compose up -d --build
```

**Impact** :
- Reconstruction compl√®te de l'image PHP avec les nouveaux outils
- T√©l√©chargement et installation de git, unzip, zip (~15 MB)
- Dur√©e : ~30 secondes

#### 3. Installation des d√©pendances Composer
```bash
docker-compose exec php composer install --no-interaction
```

**R√©sultat** :
```
Installing dependencies from lock file (including require-dev)
Package operations: 127 installs, 0 updates, 0 removals
  - Installing symfony/flex (v2.8.2)
  - Installing symfony/runtime (v7.3.4)
  - Installing symfony/routing (v7.3.4)
  [... 124 autres packages ...]
  - Installing twig/extra-bundle (v3.21.0)

Generating autoload files
110 packages you are using are looking for funding.

Executing script cache:clear [OK]
Executing script assets:install public [OK]
Executing script importmap:install [OK]
```

**Impact** :
- ‚úÖ **127 packages Symfony install√©s** (framework + bundles)
- ‚úÖ Cr√©ation du dossier `/var/www/html/vendor/`
- ‚úÖ G√©n√©ration de l'autoloader Composer
- ‚úÖ Ex√©cution automatique des scripts post-install (cache, assets)

#### 4. V√©rification du r√©sultat
```bash
curl -s http://localhost:8000 | head -20
```

**R√©sultat** :
```html
<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Welcome to Symfony!</title>
    ...
</head>
```

### Impact final :
| √âl√©ment | Avant | Apr√®s |
|---------|-------|-------|
| Dossier vendor/ | ‚ùå Absent | ‚úÖ Pr√©sent (127 packages) |
| Application Symfony | ‚ùå Erreur fatale | ‚úÖ Fonctionne |
| Page http://localhost:8000 | ‚ùå Fatal error | ‚úÖ "Welcome to Symfony!" |

### Le√ßon apprise :
**Pourquoi git et unzip sont-ils n√©cessaires ?**

Composer utilise deux m√©thodes pour t√©l√©charger les packages :
1. **M√©thode "dist"** (par d√©faut) : T√©l√©charge une archive ZIP
   - N√©cessite : `unzip`
   - Avantage : Plus rapide

2. **M√©thode "source"** (fallback) : Clone le d√©p√¥t Git
   - N√©cessite : `git`
   - Avantage : Garde l'historique Git

Sans ces outils, Composer **ne peut t√©l√©charger aucune d√©pendance** et affiche :
```
The zip extension and unzip/7z commands are both missing, skipping.
git was not found in your PATH, skipping source download
```

### Fichier Dockerfile final et complet :
```dockerfile
# Image de base : PHP 8.3 avec Apache
FROM php:8.3-apache

# Installer les d√©pendances syst√®me n√©cessaires
RUN apt-get update && apt-get install -y \
    git \
    unzip \
    zip \
    && rm -rf /var/lib/apt/lists/*

# Installer les extensions PHP n√©cessaires
RUN docker-php-ext-install pdo pdo_mysql

# Installer Composer (gestionnaire de d√©pendances)
COPY --from=composer:latest /usr/bin/composer /usr/bin/composer

# Activer le module Apache pour les URLs propres
RUN a2enmod rewrite

# Copier la configuration Apache personnalis√©e
COPY apache.conf /etc/apache2/sites-available/000-default.conf

# D√©finir le dossier de travail
WORKDIR /var/www/html

# Donner les permissions appropri√©es
RUN chown -R www-data:www-data /var/www/html
```

---

## üìä √âTAT FINAL DU PROJET

### Structure compl√®te :
```
Sprint-MiniRSN/
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îî‚îÄ‚îÄ php/
‚îÇ       ‚îú‚îÄ‚îÄ Dockerfile          ‚Üê Image PHP personnalis√©e
‚îÇ       ‚îî‚îÄ‚îÄ apache.conf         ‚Üê Configuration Apache
‚îú‚îÄ‚îÄ docker-compose.yml          ‚Üê Orchestration des services
‚îú‚îÄ‚îÄ .env                        ‚Üê Configuration Symfony (modifi√©e)
‚îú‚îÄ‚îÄ src/
‚îú‚îÄ‚îÄ public/
‚îú‚îÄ‚îÄ config/
‚îî‚îÄ‚îÄ ...
```

### Services actifs :
| Service | Container | Status | Port | URL | √âtat |
|---------|-----------|--------|------|-----|------|
| PHP + Apache | symfony_php | ‚úÖ Running | 8000 | http://localhost:8000 | ‚úÖ **Fonctionnel** |
| MySQL | symfony_db | ‚úÖ Running | 3306 | - | ‚úÖ Actif |
| phpMyAdmin | symfony_phpmyadmin | ‚úÖ Running | 8080 | http://localhost:8080 | ‚úÖ Actif |
| MailHog | symfony_mailhog | ‚úÖ Running | 8025 | http://localhost:8025 | ‚úÖ Actif |

### Packages install√©s :
- ‚úÖ **127 packages Composer** install√©s avec succ√®s
- ‚úÖ Dossier `vendor/` cr√©√© et fonctionnel
- ‚úÖ Autoloader Composer g√©n√©r√©

### Connexions entre services :
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         symfony_network (Docker Bridge)         ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îÇ
‚îÇ  ‚îÇ   PHP    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  MySQL   ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ  :8000   ‚îÇ      ‚îÇ  db:3306 ‚îÇ                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îÇ
‚îÇ       ‚îÇ                  ‚ñ≤                      ‚îÇ
‚îÇ       ‚îÇ                  ‚îÇ                      ‚îÇ
‚îÇ       ‚ñº                  ‚îÇ                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îÇ
‚îÇ  ‚îÇ MailHog  ‚îÇ      ‚îÇphpMyAdmin‚îÇ                ‚îÇ
‚îÇ  ‚îÇ  :1025   ‚îÇ      ‚îÇ  :8080   ‚îÇ                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîÑ FLUX DE DONN√âES

### 1. Requ√™te HTTP entrante
```
Navigateur (localhost:8000)
    ‚Üì
Container PHP (symfony_php:80)
    ‚Üì
Apache re√ßoit la requ√™te
    ‚Üì
Redirige vers /var/www/html/public/index.php
    ‚Üì
Symfony traite la requ√™te
    ‚Üì
Retour de la r√©ponse HTML
```

### 2. Connexion √† la base de donn√©es
```
Symfony
    ‚Üì
DATABASE_URL="mysql://root:root@db:3306/symfony_db"
    ‚Üì
Docker DNS r√©sout "db" ‚Üí IP du container symfony_db
    ‚Üì
Connexion TCP sur port 3306
    ‚Üì
MySQL (container symfony_db)
```

### 3. Envoi d'email
```
Symfony Mailer
    ‚Üì
MAILER_DSN=smtp://mailhog:1025
    ‚Üì
Docker DNS r√©sout "mailhog" ‚Üí IP du container symfony_mailhog
    ‚Üì
Email intercept√© par MailHog
    ‚Üì
Consultation via http://localhost:8025
```

---

## ‚ö†Ô∏è POINTS D'ATTENTION

### 1. Utilisation des hostnames Docker
‚ùå **NE PAS FAIRE** :
```env
DATABASE_URL="mysql://root:root@localhost:3306/symfony_db"
DATABASE_URL="mysql://root:root@127.0.0.1:3306/symfony_db"
```

‚úÖ **FAIRE** :
```env
DATABASE_URL="mysql://root:root@db:3306/symfony_db"
```

**Raison** : `localhost` dans un container pointe vers le container lui-m√™me, pas vers l'h√¥te.

### 2. Synchronisation du code
- Les modifications de fichiers PHP sont **imm√©diatement visibles** (volume bind mount)
- Pas besoin de rebuild apr√®s modification du code
- **Rebuild n√©cessaire** uniquement si modification du Dockerfile

### 3. Persistance des donn√©es
- **Code source** : Bind mount ‚Üí Modifications persistantes sur votre machine
- **Base de donn√©es** : Named volume ‚Üí Survit √† `docker-compose down`
- **‚ö†Ô∏è Attention** : `docker-compose down -v` supprime le volume (donn√©es perdues !)

---

## üéØ PROCHAINES √âTAPES RECOMMAND√âES

### 1. V√©rification de l'application
```bash
# Ouvrir dans le navigateur
http://localhost:8000
```

**Attendu** : Page d'accueil Symfony

### 2. Test de la connexion MySQL
```bash
# Entrer dans le container PHP
docker-compose exec php bash

# Tester la connexion
php bin/console doctrine:database:create --if-not-exists
```

### 3. Cr√©ation d'entit√©s
```bash
docker-compose exec php php bin/console make:entity User
```

### 4. Migrations de base de donn√©es
```bash
docker-compose exec php php bin/console make:migration
docker-compose exec php php bin/console doctrine:migrations:migrate
```

### 5. V√©rification phpMyAdmin
```
URL : http://localhost:8080
Login : root
Password : root
```

**V√©rifier** : Pr√©sence de la base `symfony_db`

### 6. Test MailHog
```
URL : http://localhost:8025
```

**Test** : Envoyer un email depuis Symfony et v√©rifier qu'il appara√Æt dans MailHog

---

## üìù COMMANDES UTILES

### Gestion des containers
```bash
# D√©marrer
docker-compose up -d

# Arr√™ter
docker-compose stop

# Arr√™ter et supprimer
docker-compose down

# Voir les logs
docker-compose logs -f php

# Voir les containers actifs
docker-compose ps
```

### Ex√©cution de commandes Symfony
```bash
# Structure g√©n√©rale
docker-compose exec php [commande]

# Exemples
docker-compose exec php composer install
docker-compose exec php php bin/console cache:clear
docker-compose exec php php bin/console make:controller
```

### Acc√®s shell
```bash
# Shell dans le container PHP
docker-compose exec php bash

# Shell dans le container MySQL
docker-compose exec db bash
```

---

## üîß D√âPANNAGE

### Probl√®me : Port d√©j√† utilis√©
**Erreur** : `Bind for 0.0.0.0:8000 failed: port is already allocated`

**Solution** : Modifier le port dans docker-compose.yml
```yaml
ports:
  - "8001:80"  # Au lieu de 8000
```

### Probl√®me : Connection refused √† MySQL
**V√©rifications** :
1. Le service `db` est-il d√©marr√© ? ‚Üí `docker-compose ps`
2. Utilisez-vous `@db` dans DATABASE_URL ? (pas `@localhost`)
3. Les credentials sont-ils corrects ? (`root:root`)

### Probl√®me : 403 Forbidden
**Cause probable** : Permissions sur les fichiers

**Solution** :
```bash
docker-compose exec php chown -R www-data:www-data /var/www/html
```

### Probl√®me : Modifications PHP non prises en compte
**Solution** : Vider le cache Symfony
```bash
docker-compose exec php php bin/console cache:clear
```

---

## üìö RESSOURCES

- Fiche de r√©vision : `FICHE_REVISION_DOCKER_SYMFONY.md`
- Documentation Docker : https://docs.docker.com/
- Documentation Symfony : https://symfony.com/doc/

---

---

## ‚úÖ R√âSUM√â DES √âTAPES DE CONFIGURATION

| # | √âtape | Fichiers cr√©√©s/modifi√©s | Status |
|---|-------|-------------------------|--------|
| 1 | Cr√©ation structure Docker | `docker/php/` | ‚úÖ |
| 2 | Cr√©ation Dockerfile PHP | `docker/php/Dockerfile` | ‚úÖ |
| 3 | Configuration Apache | `docker/php/apache.conf` | ‚úÖ |
| 4 | Docker Compose | `docker-compose.yml` | ‚úÖ |
| 5 | Configuration .env | `.env` (DATABASE_URL, MAILER_DSN) | ‚úÖ |
| 6 | Nettoyage fichiers | Suppression de `compose.yaml` et `compose.override.yaml` | ‚úÖ |
| 7 | D√©marrage services | 4 containers actifs | ‚úÖ |
| 8 | **R√©solution erreur vendor/** | Ajout git/unzip + composer install | ‚úÖ |

### R√©sultat final :
üéâ **Environnement Docker Symfony 7 op√©rationnel √† 100%**

- ‚úÖ PHP 8.3 + Apache configur√© avec extensions MySQL
- ‚úÖ MySQL 8.0 accessible via hostname `db`
- ‚úÖ phpMyAdmin fonctionnel (root/root)
- ‚úÖ MailHog pr√™t pour l'interception d'emails
- ‚úÖ 127 packages Composer install√©s
- ‚úÖ Application Symfony affiche "Welcome to Symfony!"

---

**Derni√®re mise √† jour** : 13 octobre 2025, 20:52
**Version finale** : Configuration compl√®te et fonctionnelle
