{% extends 'base.html.twig' %}

{% block title %}Accueil - Mini RSN{% endblock %}

{% block body %}
{# PAGE D'ACCUEIL - LISTE DES POSTS (uniquement si connecté) #}

<div class="min-h-screen bg-gray-50 dark:bg-gray-900">
    {# NAVBAR EN HAUT #}
    <nav class="bg-white dark:bg-gray-800 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                {# Logo et titre #}
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z"></path>
                        </svg>
                    </div>
                    <span class="text-xl font-bold text-gray-900 dark:text-white">Mini RSN</span>
                </div>

                {# Boutons à droite #}
                <div class="flex items-center gap-4">
                    {# Nom de l'utilisateur connecté #}
                    <span class="text-sm text-gray-600 dark:text-gray-300">
                        {{ app.user.email }}
                    </span>

                    {# Bouton Dark Mode #}
                    <button id="darkModeToggle"
                            class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-yellow-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition-all">
                        <svg id="sunIcon" class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                        <svg id="moonIcon" class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                    </button>

                    {# Bouton Déconnexion #}
                    <a href="{{ path('app_logout') }}"
                       class="px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors">
                        Déconnexion
                    </a>
                </div>
            </div>
        </div>
    </nav>

    {# CONTENU PRINCIPAL #}
    <div class="max-w-4xl mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-8">
            Fil d'actualité
        </h1>

        {# SI AUCUN POST #}
        {% if posts is empty %}
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-12 text-center">
                <svg class="w-16 h-16 text-gray-400 dark:text-gray-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
                </svg>
                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">
                    Aucune publication
                </h3>
                <p class="text-gray-600 dark:text-gray-400">
                    Soyez le premier à publier un message !
                </p>
            </div>
        {% else %}
            {# BOUCLE SUR LES POSTS #}
            <div class="space-y-6">
                {% for post in posts %}
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow">
                        {# EN-TÊTE DU POST (auteur + date) #}
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    {# Avatar (première lettre de l'email) #}
                                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold">
                                        {{ post.user.email|slice(0, 1)|upper }}
                                    </div>
                                    {# Nom de l'auteur #}
                                    <div>
                                        <p class="font-semibold text-gray-900 dark:text-white">
                                            {{ post.user.email }}
                                        </p>
                                        {# Date de création #}
                                        <p class="text-sm text-gray-500 dark:text-gray-400">
                                            {{ post.createdAt|date('d/m/Y à H:i') }}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {# CONTENU DU POST #}
                        <div class="px-6 py-4">
                            <p class="text-gray-900 dark:text-white whitespace-pre-line">
                                {{ post.content }}
                            </p>
                        </div>

                        {# IMAGE (si présente) #}
                        {% if post.image %}
                            <div class="px-6 pb-4">
                                <img src="{{ asset('uploads/posts/' ~ post.image) }}"
                                     alt="Image du post"
                                     class="w-full rounded-lg shadow-md">
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
</div>

{# Script Dark Mode #}
<script>
    document.getElementById('darkModeToggle').addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
    });
</script>
{% endblock %}
